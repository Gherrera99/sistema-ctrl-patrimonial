// hospital-inventarios-api/prisma/schema.prisma
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  ADMIN
  COLABORADOR
}

enum TipoBien {
  ADMINISTRATIVO
  MEDICO
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(COLABORADOR)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EstadoFisico {
  id     Int    @id @default(autoincrement())
  code   String @unique
  label  String
  orden  Int    @default(99)
  items  InventoryItem[]
}

model Ubicacion {
  id     Int    @id @default(autoincrement())
  code   String @unique
  nombre String
  orden  Int    @default(99)
  items  InventoryItem[]
}

model ClasificacionBien {
  id      Int     @id @default(autoincrement())
  sigla   String  @unique
  nombre  String?
  items   InventoryItem[]
}

model InventoryItem {
  id                 Int       @id @default(autoincrement())
  no_inventario      String    @unique @db.VarChar(20)
  nombre             String    @db.VarChar(255)
  consecutivo        Int?
  cuenta             String?   @db.VarChar(100)
  otras_observaciones String?
  costo_adquisicion  Decimal?  @db.Decimal(12,2)
  clasificacionId    Int?
  clasificacion      ClasificacionBien? @relation(fields: [clasificacionId], references: [id])
  responsable        String    @db.VarChar(255)
  rfc                String    @db.VarChar(25)
  no_factura         String?   @db.VarChar(30)
  fecha_adjudicacion DateTime?
  modelo             String?   @db.VarChar(255)
  marca              String?   @db.VarChar(255)
  no_serie           String?   @db.VarChar(255)
  observaciones      String?
  fecha_entrega      DateTime?

  // ⬅️ ahora el campo que usará el código es "tipo"
  //     pero mapea a la columna existente "tipo_bien"
  tipo               TipoBien  @default(ADMINISTRATIVO) @map("tipo_bien")

  estadoId    Int?
  estado      EstadoFisico? @relation(fields: [estadoId], references: [id])

  ubicacionId Int?
  ubicacion   Ubicacion?    @relation(fields: [ubicacionId], references: [id])

  createdById Int?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([no_inventario])
  @@index([responsable])
}

model AuthorizerGroup {
  id          Int      @id @default(autoincrement())
  code        TipoBien @unique
  name        String
  authorizers Authorizer[]
}

model Authorizer {
  id        Int      @id @default(autoincrement())
  fullName  String
  title     String
  entity    String
  active    Boolean  @default(true)
  validFrom DateTime @default(now())
  validTo   DateTime?
  groupId   Int
  group     AuthorizerGroup @relation(fields: [groupId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
