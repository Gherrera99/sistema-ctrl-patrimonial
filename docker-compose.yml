version: "3.8"
services:
  db:
    image: mysql:8.0
    container_name: hospital_mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: hospital_inventarios
    ports: [ "3306:3306" ]
    volumes: [ "dbdata:/var/lib/mysql" ]
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 5s
      timeout: 5s
      retries: 10
  adminer:
    image: adminer:4
    container_name: hospital_adminer
    ports: [ "8080:8080" ]
    depends_on: [ db ]
  api:
    build: ./hospital-inventarios-api
    container_name: hospital_api
    environment:
      - DATABASE_URL=mysql://root:root@db:3306/hospital_inventarios
      - JWT_SECRET=supersecret
      - NODE_ENV=production
      - PORT=8000
      - ALLOW_ORIGIN=http://localhost:8081

      # ====== NUEVO: cabecera y logos del PDF ======
      - PDF_HEADER_ENTITY=HOSPITAL DE LA AMISTAD
      - PDF_HEADER_ADDRESS=CALLE 60 SUR S/N COL SAN JOSE TECOH X ANILLO PERIFERICO SAN JOSE TECOH PONIENTE
      - PDF_LOGO_LEFT=/app/assets/logo_left.png
      - PDF_LOGO_RIGHT=/app/assets/logo_right.png

      # Firma ‚ÄúResponsable del seguimiento y control‚Äù
      - PDF_CONTROL_NAME=C. ABIB ALEXIS VALLEJOS P√âREZ

      # Texto de ENTIDAD que aparece junto al autorizador
      - PDF_AUTH_ENTITY=HOSPITAL DE LA AMISTAD
    volumes:
      # Monta la carpeta local con los logos dentro del contenedor (solo lectura)
      - ./hospital-inventarios-api/assets:/app/assets:ro
    depends_on:
      db:
        condition: service_healthy
    ports: [ "8000:8000" ]
  web:
    build:
      context: ./hospital-inventarios-web
      args:
        - VITE_OWNER_EMAIL=gustavo.herrera   # üëà pon aqu√≠ tu email
    container_name: hospital_web
    depends_on: [ api ]
    ports: [ "8081:80" ]
volumes: { dbdata: {} }
